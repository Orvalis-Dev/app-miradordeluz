---
import { ViewTransitions } from 'astro:transitions';
import '../styles/global.css';

// FontSource Imports
import '@fontsource/montserrat/300.css';
import '@fontsource/montserrat/400.css';
import '@fontsource/montserrat/500.css';
import '@fontsource/montserrat/600.css';
import '@fontsource/montserrat/700.css';
import '@fontsource/montserrat/800.css';
import '@fontsource/merriweather/400.css';
import '@fontsource/merriweather/700.css';
import '@fontsource/merriweather/900.css';

interface Props {
  title: string;
  description?: string;
  image?: string;
  noIndex?: boolean; // Opción para ocultar páginas que no quieras indexar (ej: gracias por su compra)
}

const { 
  title, 
  // Descripción por defecto optimizada si no pasas una específica
  description = 'Disfrutá de la paz en las sierras de Córdoba. Cabañas totalmente equipadas con piscina, wifi y vistas increíbles a solo 5 min de Carlos Paz.',
  image = '/og-image.jpg', // Imagen de portada para redes sociales
  noIndex = false
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// Lógica mejorada: Si el título ya tiene la marca, no la repite.
const siteName = 'Mirador de Luz';
const fullTitle = title.includes(siteName) ? title : `${title} | ${siteName}`;

// Datos reales extraídos de tus imágenes para el Schema (Google Maps data)
const businessData = {
  name: "Complejo de Cabañas Mirador de Luz",
  address: "Las Orquideas 893, X5152 Villa Santa Cruz del Lago, Córdoba, Argentina",
  phone: "+543813513513",
  email: "miradordeluz2019@gmail.com",
  image: new URL(image, Astro.site).toString(),
  priceRange: "$$" 
};

// Schema.org JSON-LD para Hoteles/Alojamientos (CRUCIAL PARA SEO)
const schema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "LodgingBusiness",
  "name": businessData.name,
  "image": [businessData.image],
  "description": description,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Las Orquideas 893",
    "addressLocality": "Villa Santa Cruz del Lago",
    "addressRegion": "Córdoba",
    "postalCode": "X5152",
    "addressCountry": "AR"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": -31.3995, // APROXIMADO: Verifica esto en Google Maps con tu pin exacto
    "longitude": -64.5020 // APROXIMADO: Verifica esto en Google Maps
  },
  "telephone": businessData.phone,
  "email": businessData.email,
  "url": Astro.site,
  "starRating": {
    "@type": "Rating",
    "ratingValue": "5" // Basado en tus reviews de Google
  },
  "amenityFeature": [
    { "@type": "LocationFeatureSpecification", "name": "Piscina", "value": "True" },
    { "@type": "LocationFeatureSpecification", "name": "WiFi", "value": "True" },
    { "@type": "LocationFeatureSpecification", "name": "Estacionamiento", "value": "True" },
    { "@type": "LocationFeatureSpecification", "name": "Vista a la montaña", "value": "True" }
  ]
});
---

<!DOCTYPE html>
<html lang="es-AR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />
  
  <title>{fullTitle}</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={canonicalURL} />
  <meta name="theme-color" content="#FF8C00" /> {noIndex ? <meta name="robots" content="noindex, nofollow" /> : <meta name="robots" content="index, follow" />}

  <meta name="geo.region" content="AR-X" />
  <meta name="geo.placename" content="Villa Santa Cruz del Lago" />
  <meta name="geo.position" content="-31.3995;-64.5020" /> <meta name="ICBM" content="-31.3995, -64.5020" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content={canonicalURL} />
  <meta property="og:title" content={fullTitle} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={new URL(image, Astro.site)} />
  <meta property="og:site_name" content={siteName} />
  <meta property="og:locale" content="es_AR" />
  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content={canonicalURL} />
  <meta name="twitter:title" content={fullTitle} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={new URL(image, Astro.site)} />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  
  <script type="application/ld+json" set:html={schema} />

  <link rel="sitemap" href="/sitemap-index.xml" />
  <ViewTransitions />
</head>
<body class="min-h-screen flex flex-col bg-gray-50 text-gray-900 selection:bg-orange-500 selection:text-white">
  <slot />

  <script>
    /**
     * Mejora del scroll para sitios con animaciones GSAP y expansiones de layout.
     * Realiza múltiples intentos de posicionamiento para asegurar que los cambios
     * de altura de la página (por carga de imágenes o animaciones) no pierdan el objetivo.
     */
    const scrollToHash = () => {
      const hash = window.location.hash;
      if (!hash) return;

      const targetId = hash.substring(1);
      const targetElement = document.getElementById(targetId);

      if (targetElement) {
        // 1. Intento casi inmediato (fuerza la carga de la zona)
        setTimeout(() => {
          targetElement.scrollIntoView({ behavior: 'auto', block: 'start' });
        }, 100);

        // 2. Segundo intento a los 500ms (cuando React/Hydration suele haber terminado)
        setTimeout(() => {
          targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 500);

        // 3. Intento final definitivo a los 1500ms 
        // (después de animaciones de expansión de 1s y cálculos de GSAP)
        setTimeout(() => {
          targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 1500);
      }
    };

    // Ejecutar al cargar la página (inicial y transiciones)
    document.addEventListener('astro:page-load', scrollToHash);
    
    // Si el usuario hace clic en un link con hash estando en la misma página
    window.addEventListener('hashchange', scrollToHash);
  </script>
</body>
</html>

